import{E as h}from"./index-41c3c3d0.js";import{q as a,ab as l,C as d,e as c,ac as u,a0 as p,ad as r,ae as m,af as v,ag as f,D as E,ah as g}from"./index-d420b9fe.js";function o(i){return v((e,n)=>({get(){return e(),i},set(t){i=t,requestAnimationFrame(()=>{requestAnimationFrame(()=>{n()})})}}))}class S extends h{constructor(e={}){return super(e),this.vueRenderers=a(new Map),this.contentComponent=null,this.reactiveState=o(this.view.state),this.reactiveExtensionStorage=o(this.extensionStorage),this.on("transaction",()=>{this.reactiveState.value=this.view.state,this.reactiveExtensionStorage.value=this.extensionStorage}),l(this)}get state(){return this.reactiveState?this.reactiveState.value:this.view.state}get storage(){return this.reactiveExtensionStorage?this.reactiveExtensionStorage.value:super.storage}registerPlugin(e,n){super.registerPlugin(e,n),this.reactiveState.value=this.view.state}unregisterPlugin(e){super.unregisterPlugin(e),this.reactiveState.value=this.view.state}}const x=d({name:"EditorContent",props:{editor:{default:null,type:Object}},setup(i){const e=c(),n=g();return u(()=>{const t=i.editor;t&&t.options.element&&e.value&&f(()=>{if(!e.value||!t.options.element.firstChild)return;const s=E(e.value);e.value.append(...t.options.element.childNodes),t.contentComponent=n.ctx._,t.setOptions({element:s}),t.createNodeViews()})}),p(()=>{const t=i.editor;if(!t||(t.isDestroyed||t.view.setProps({nodeViews:{}}),t.contentComponent=null,!t.options.element.firstChild))return;const s=document.createElement("div");s.append(...t.options.element.childNodes),t.setOptions({element:s})}),{rootEl:e}},render(){const i=[];return this.editor&&this.editor.vueRenderers.forEach(e=>{const n=r(m,{to:e.teleportElement,key:e.id},r(e.component,{ref:e.id,...e.props}));i.push(n)}),r("div",{ref:e=>{this.rootEl=e}},...i)}});class F{constructor(e,{props:n={},editor:t}){if(this.id=Math.floor(Math.random()*4294967295).toString(),this.editor=t,this.component=l(e),this.teleportElement=document.createElement("div"),this.element=this.teleportElement,this.props=a(n),this.editor.vueRenderers.set(this.id,this),this.editor.contentComponent){if(this.editor.contentComponent.update(),this.teleportElement.children.length!==1)throw Error("VueRenderer doesnâ€™t support multiple child elements.");this.element=this.teleportElement.firstElementChild}}get ref(){var e;return(e=this.editor.contentComponent)===null||e===void 0?void 0:e.refs[this.id]}updateProps(e={}){Object.entries(e).forEach(([n,t])=>{this.props[n]=t})}destroy(){this.editor.vueRenderers.delete(this.id)}}export{x as E,F as V,S as a};
