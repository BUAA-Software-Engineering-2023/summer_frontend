import{C as be,e as i,s as he,q as we,h as ye,r as s,o as u,c as D,a as n,b as t,w as o,k as v,F as ge,x as Ce,z as g,D as H,t as W,m as M,l as Y,i as J,v as K,E as O,G as xe,H as ke,p as Te,d as Ve,I as E,_ as Ae}from"./index-d420b9fe.js";import{t as r}from"./team-b7aacf9b.js";const q=C=>(Te("data-v-26d69c28"),C=C(),Ve(),C),De={class:"side"},Me={class:"common-layout"},Ue={class:"back"},$e=q(()=>n("h2",null,"团队管理",-1)),Ne={class:"leftbox"},Se={class:"btton"},Ee={class:"avatar"},qe={class:"manage"},Be={class:"dialog-footer"},ze={class:"moji"},Ie={class:"back"},Le={key:0,class:"rightbox"},Fe={class:"mainTitle"},Re={class:"teamName"},je={class:"title"},Ge=q(()=>n("button",null,[n("i",{class:"bx bx-search"})],-1)),He=q(()=>n("button",null,[n("i",{class:"bx bx-search"})],-1)),We={key:1,class:"rightbox",style:{width:"100%"}},Ye="140px",Je=be({__name:"MemberBoard",setup(C){const B=i([]),b=i([]),z=i([]),h=i(!1),x=i(!1),I=i(""),k=i(""),U=i(""),f=i(),p=i(!1),$=i(!1),w=i(!1),P=()=>{console.log("cancel!")};function L(){b.value.forEach(l=>{l.role==="团队创建者"&&l.id.toString()===E()&&(w.value=!0,p.value=!1,$.value=!1),l.role==="团队管理员"&&l.id.toString()===E()&&(p.value=!1,w.value=!1,$.value=!0),l.role==="普通成员"&&l.id.toString()===E()&&(p.value=!0,$.value=!1,w.value=!1)})}async function Q(l){await r.inviteTeamMember(f.value,l.id),await T(),x.value=!1}async function N(){let l=await r.queryAllTeams();B.value=l.data,L()}async function X(l,e){try{const c=await r.queryTeamMember(l);b.value=c.data.members.sort((m,S)=>{const A={团队创建者:1,团队管理员:2,普通成员:3};return A[m.role]-A[S.role]}),console.log(b.value),I.value=e,f.value=l,L()}catch(c){O.error(c.message)}}async function Z(){h.value=!1,await r.addTeam(V.name),await N()}async function ee(l){await r.deleteTeam(l),await N()}async function te(l){try{l.role==="普通成员"?await r.deleteTeamMember(f.value,l.id):O.error("不能删除管理员"),await T()}catch(e){console.log(e.message)}}async function le(l){let e=await r.queryAllUser(l);console.log("***********Userresult***********"),console.log(e.data),console.log("***********result***********"),z.value=e.data.results}async function T(){let l=await r.queryTeamMember(f.value);b.value=l.data.members.sort((e,c)=>{const m={团队创建者:1,团队管理员:2,普通成员:3};return m[e.role]-m[c.role]})}async function ae(l){console.log("handle"),console.log(l),await r.addAdmin(f.value,l),await T()}async function oe(l){await r.deleteAdmin(f.value,l),await T()}he(()=>{N()});const V=we({name:"",region:"",date1:"",date2:"",delivery:!1,type:[],resource:"",desc:""}),ne=ye(()=>b.value.filter(l=>!k.value||l.name.toLowerCase().includes(k.value.toLowerCase()))),se=(l,e)=>{ae(e.id)},ie=(l,e)=>{oe(e.id)};return(l,e)=>{const c=s("el-header"),m=s("el-icon"),S=s("el-input"),A=s("el-form-item"),re=s("el-form"),_=s("el-button"),F=s("el-dialog"),de=s("el-divider"),ue=s("el-popconfirm"),ce=s("el-menu-item"),me=s("el-menu"),_e=s("el-col"),fe=s("el-row"),R=s("el-aside"),d=s("el-table-column"),j=s("el-table"),ve=s("el-main"),G=s("el-container"),pe=s("el-empty");return u(),D("div",De,[n("div",Me,[n("div",Ue,[t(c,null,{default:o(()=>[$e]),_:1})]),t(G,{class:"container"},{default:o(()=>[t(R,{width:"250px"},{default:o(()=>[n("div",Ne,[t(fe,{class:"tac",id:"container1"},{default:o(()=>[t(_e,{span:24},{default:o(()=>[n("div",Se,[n("div",Ee,[t(m,{class:"custom-icon-button"})]),n("div",qe,[n("button",{class:"btn",onClick:e[0]||(e[0]=a=>h.value=!0)},"创建新的团队 ")]),t(F,{modelValue:h.value,"onUpdate:modelValue":e[3]||(e[3]=a=>h.value=a),title:"欢迎来到寄了网站，请创建团队",center:"",width:"35%"},{footer:o(()=>[n("span",Be,[t(_,{onClick:e[2]||(e[2]=a=>h.value=!1)},{default:o(()=>[v("Cancel")]),_:1}),t(_,{type:"primary",onClick:Z},{default:o(()=>[v(" Confirm ")]),_:1})])]),default:o(()=>[t(re,{model:V},{default:o(()=>[t(A,{label:"团队名称","label-width":Ye},{default:o(()=>[t(S,{modelValue:V.name,"onUpdate:modelValue":e[1]||(e[1]=a=>V.name=a),autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),t(de),t(me,{class:"el-menu-vertical-demo"},{default:o(()=>[(u(!0),D(ge,null,Ce(B.value,a=>(u(),g(ce,{key:a.id,onClick:y=>X(a.id,a.name)},{default:o(()=>[t(m,null,{default:o(()=>[t(H(xe))]),_:1}),n("span",ze,W(a.name),1),t(ue,{"confirm-button-text":"Yes","cancel-button-text":"No",icon:H(ke),"icon-color":"#626AEF",title:"你确定要删除该团队吗?",onConfirm:y=>ee(a.id),onCancel:P},{reference:o(()=>[t(_,null,{default:o(()=>[v("Delete")]),_:1})]),_:2},1032,["icon","onConfirm"])]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1})])]),_:1}),n("div",Ie,[t(R,{width:"20px"})]),f.value?(u(),D("div",Le,[t(G,null,{default:o(()=>[t(c,{height:"40px",width:"100%"},{default:o(()=>[n("div",Fe,[n("div",Re,[n("div",je,W(I.value),1),p.value?M("",!0):(u(),g(_,{key:0,text:"",class:"interval",onClick:e[4]||(e[4]=a=>x.value=!0)},{default:o(()=>[t(m,{class:"el-icon--right"})]),_:1}))]),t(F,{modelValue:x.value,"onUpdate:modelValue":e[8]||(e[8]=a=>x.value=a),title:"用户列表"},{default:o(()=>[t(j,{data:z.value,style:{width:"100%"}},{default:o(()=>[t(d,{prop:"name",label:"Name",sortable:""}),t(d,{prop:"username",label:"Username",sortable:""}),t(d,{prop:"email",label:"Email",sortable:""}),t(d,{align:"right",width:"200"},{header:o(()=>[n("form",{class:"search-bar",onSubmit:e[7]||(e[7]=Y(()=>{},["prevent"]))},[J(n("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>U.value=a),size:"small",placeholder:"Type to search",onChange:e[6]||(e[6]=a=>le(U.value))},null,544),[[K,U.value]]),Ge],32)]),default:o(a=>[t(_,{size:"small",type:"danger",onClick:y=>Q(a.row)},{default:o(()=>[v("ADD")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])])]),_:1}),t(ve,null,{default:o(()=>[t(j,{data:ne.value,style:{width:"800px"}},{default:o(()=>[t(d,{prop:"name",label:"Name",sortable:""}),t(d,{prop:"username",label:"Username",sortable:""}),t(d,{prop:"email",label:"Email",sortable:""}),t(d,{prop:"role",label:"Role",sortable:""}),t(d,{align:"right",width:"200"},{header:o(()=>[n("form",{class:"search-bar",onSubmit:e[11]||(e[11]=Y(()=>{},["prevent"]))},[J(n("input",{"onUpdate:modelValue":e[9]||(e[9]=a=>k.value=a),type:"text",placeholder:"Search...",onChange:e[10]||(e[10]=()=>{})},null,544),[[K,k.value]]),He],32)]),default:o(a=>[a.row.role==="团队管理员"&&w.value===!0?(u(),g(_,{key:0,size:"small",onClick:y=>ie(a.$index,a.row)},{default:o(()=>[v("RmvAuth")]),_:2},1032,["onClick"])):M("",!0),a.row.role==="普通成员"&&p.value===!1?(u(),g(_,{key:1,size:"small",onClick:y=>se(a.$index,a.row)},{default:o(()=>[v("Auth")]),_:2},1032,["onClick"])):M("",!0),a.row.role==="普通成员"&&p.value===!1||a.row.role==="团队管理员"&&w.value===!0?(u(),g(_,{key:2,size:"small",type:"danger",onClick:y=>te(a.row)},{default:o(()=>[v("Delete")]),_:2},1032,["onClick"])):M("",!0)]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})])):(u(),D("div",We,[t(pe,{description:"请选择团队",style:{height:"100%"}})]))]),_:1})])])}}});const Pe=Ae(Je,[["__scopeId","data-v-26d69c28"]]);export{Pe as default};
