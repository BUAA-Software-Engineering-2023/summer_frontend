import{D as G,H as X,a as j,T as K,b as Y,C as J,c as Q,d as Z,M as ee,e as te,E as oe,h as ne,F as ae}from"./FileSaver.min-f6114a76.js";import{S as F}from"./index-41c3c3d0.js";import{a as le,E as se}from"./index-bea6d51e.js";import{s as ie}from"./suggestion-e545872f.js";import{g as re,e as v,s as ce,E as D,a0 as ue,r as h,o as g,c as p,b as e,w as n,a as r,t as w,m as y,A as c,F as H,k as f,D as u,a8 as I,a1 as d}from"./index-d420b9fe.js";import{d as P}from"./document-1fa91d60.js";import"./team-b7aacf9b.js";const de={class:"common-layout"},ve={class:"editor__header"},me={key:0,class:"title"},fe={key:0,class:"button-container"},ge={class:"column"},pe={class:"column"},he={class:"column"},we={class:"buttonSet"},_e={class:"column"},be={class:"column"},Ce={key:0,class:"editor"},ke={class:"editor__footer"},xe={class:"editor__name"},ye=`
.title {
  height: 64px;
  width: 800px;
  text-align: center;
  line-height: 64px;
  font-size: 20px;
  font-family: PingFangSC-Regular, PingFang SC;
  font-weight: 500;
  color: rgba(0, 11, 46, 0.85);
}
.all-box {
  position: relative;
}
.all-topic {
  padding: 24px;
}
`,He={__name:"share",setup(Se){const S=re(),B=["#958DF1","#F98181","#FBBC88","#FAF594","#70CFF8","#94FADB","#B9F18D"];function $(){return B[Math.floor(Math.random()*B.length)]}const C=v(),t=v(),A=v("connecting"),k=v(S.params.sharedId||"123"),E=v("");v([]),v([]);const M=v("");v(M.value);const x=v(!0),R=v(!1),L=v({name:S.params.documentId||"123",color:$()});v(S.params.sharedId),ce(async()=>{const i=await P.getDocumentContent(k.value),o=new G;C.value=new X({url:"ws://127.0.0.1:1234",name:k.value,document:o,forceSyncInterval:200}),C.value.on("status",a=>{A.value=a.status}),t.value=new le({editable:x,extensions:[F.configure({history:!1}),j,K,Y,J.configure({document:o}),Q.configure({provider:C.value,user:L.value}),Z.configure({limit:1e5}),F,ee.configure({HTMLAttributes:{class:"mention"},suggestion:ie})]});const m=i.data;m.detail==="已授权阅读"?m.editable===!1?(t.value.setEditable(!1),x.value=!1):t.value.setEditable(!0):D({message:"你没有权限阅读",type:"error"}),console.log("document",k.value)}),ue(()=>{t.value.destroy(),C.value.destroy()});async function W(){try{const i=t.value.getHTML();console.log(i),console.log(I()),await P.saveDocument(I(),i),D({message:"保存成功",type:"success"})}catch{D({message:"保存失败",type:"error"})}}function N(){const o=new te({headingStyle:"atx",hr:"---",bulletListMarker:"-",codeBlockStyle:"fenced",emDelimiter:"*"}).turndown(t.value.getHTML()),m=new Blob([o],{type:"text/markdown;charset=utf-8"}),a=document.createElement("a");a.href=URL.createObjectURL(m),a.download="filename.txt",a.click(),URL.revokeObjectURL(a.href)}function U(){const i=new oe;i.setDocumentProperties({title:"HTML to PDF",author:"SE2023",creator:"SE2023"});const o=document.querySelector("#editor");ne(o,{scale:2}).then(m=>{const a=m.toDataURL("image/png",1),l=i.getImageProperties(a),_=i.internal.pageSize.getWidth(),T=l.height*_/l.width,b=20,s=20,q=_-2*b,z=T-2*s;i.addImage(a,"PNG",b,s,q,z),i.save("filename.pdf")})}function V(i){return`<!DOCTYPE html>
                <html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office"
                  xmlns:w="urn:schemas-microsoft-com:office:word" xmlns:m="http://schemas.microsoft.com/office/2004/12/omml"
                  xmlns="http://www.w3.org/TR/REC-html40">
                <head>
                  <!--[if gte mso 9]><xml><w:WordDocument><w:View>Print</w:View><w:TrackMoves>false</w:TrackMoves><w:TrackFormatting/><w:ValidateAgainstSchemas/><w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid><w:IgnoreMixedContent>false</w:IgnoreMixedContent><w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText><w:DoNotPromoteQF/><w:LidThemeOther>EN-US</w:LidThemeOther><w:LidThemeAsian>ZH-CN</w:LidThemeAsian><w:LidThemeComplexScript>X-NONE</w:LidThemeComplexScript><w:Compatibility><w:BreakWrappedTables/><w:SnapToGridInCell/><w:WrapTextWithPunct/><w:UseAsianBreakRules/><w:DontGrowAutofit/><w:SplitPgBreakAndParaMark/><w:DontVertAlignCellWithSp/><w:DontBreakConstrainedForcedTables/><w:DontVertAlignInTxbx/><w:Word11KerningPairs/><w:CachedColBalance/><w:UseFELayout/></w:Compatibility><w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel><m:mathPr><m:mathFont m:val="Cambria Math"/><m:brkBin m:val="before"/><m:brkBinSub m:val="--"/><m:smallFrac m:val="off"/><m:dispDef/><m:lMargin m:val="0"/> <m:rMargin m:val="0"/><m:defJc m:val="centerGroup"/><m:wrapIndent m:val="1440"/><m:intLim m:val="subSup"/><m:naryLim m:val="undOvr"/></m:mathPr></w:WordDocument></xml><![endif]-->

                    <meta charset="utf-8">
                    <meta name="viewport" content="width=device-width,initial-scale=1.0">
                    <title>{{title}}</title>
                    <style>${ye}</style>
                </head>
                <body>
                    <div style="display: flex;justify-content: center;">
                      ${i}
                    </div>
                </body>
                </html>`}function O(){const i=V(t.value.getHTML()),o=new Blob([i],{type:"application/msword;charset=utf-8"});ae.saveAs(o,E.value+".doc")}return(i,o)=>{const m=h("el-header"),a=h("el-button"),l=h("el-popover"),_=h("el-affix"),T=h("el-main"),b=h("el-container");return g(),p("div",de,[e(b,null,{default:n(()=>[e(m,null,{default:n(()=>[r("div",ve,[r("div",null,[R.value?y("",!0):(g(),p("span",me,"111"+w(M.value),1))]),x.value?(g(),p("div",{key:0,class:c(`editor__status editor__status--${A.value}`)},[A.value==="connected"?(g(),p(H,{key:0},[f(w(t.value.storage.collaborationCursor.users.length)+" user"+w(t.value.storage.collaborationCursor.users.length===1?"":"s")+" online in "+w(k.value),1)],64)):(g(),p(H,{key:1},[f(" offline ")],64)),f(" "+w(L.value.name),1)],2)):y("",!0),r("div",{class:"optionButton"},[r("button",{onClick:W},"Save"),r("button",{onClick:N},"导出为Markdown"),r("button",{onClick:U},"导出为PDF"),r("button",{onClick:O},"导出为Word")])])]),_:1}),e(_,null,{default:n(()=>[e(b,null,{default:n(()=>[e(T,null,{default:n(()=>[e(_,null,{default:n(()=>[t.value&&x.value?(g(),p("div",fe,[r("div",ge,[e(l,{placement:"top-start",title:"加粗(Ctrl+B)",width:100,trigger:"hover",content:"将文本加粗"},{reference:n(()=>[e(a,{onClick:o[0]||(o[0]=s=>t.value.chain().focus().toggleBold().run()),disabled:!t.value.can().chain().focus().toggleBold().run(),class:c({"is-active":t.value.isActive("bold")})},{default:n(()=>[e(u(d),{icon:["fas","bold"]})]),_:1},8,["disabled","class"])]),_:1}),e(l,{placement:"top-start",title:"高亮",width:100,trigger:"hover",content:"将文本高亮"},{reference:n(()=>[e(a,{onClick:o[1]||(o[1]=s=>t.value.chain().focus().toggleHighlight().run()),class:c({"is-active":t.value.isActive("highlight")})},{default:n(()=>[e(u(d),{icon:["fas","highlighter"]})]),_:1},8,["class"])]),_:1}),e(l,{placement:"top-start",title:"倾斜(Ctrl+l)",width:100,trigger:"hover",content:"将文字变为斜体"},{reference:n(()=>[e(a,{onClick:o[2]||(o[2]=s=>t.value.chain().focus().toggleItalic().run()),disabled:!t.value.can().chain().focus().toggleItalic().run(),class:c({"is-active":t.value.isActive("italic")})},{default:n(()=>[e(u(d),{icon:["fas","italic"]})]),_:1},8,["disabled","class"])]),_:1}),e(l,{placement:"top-start",title:"删除线",width:100,trigger:"hover",content:"在文本中间画一条线"},{reference:n(()=>[e(a,{onClick:o[3]||(o[3]=s=>t.value.chain().focus().toggleStrike().run()),disabled:!t.value.can().chain().focus().toggleStrike().run(),class:c({"is-active":t.value.isActive("strike")})},{default:n(()=>[e(u(d),{icon:["fas","strikethrough"]})]),_:1},8,["disabled","class"])]),_:1}),e(l,{placement:"top-start",title:"代码块",width:100,trigger:"hover",content:"将文本转换为代码块"},{reference:n(()=>[e(a,{onClick:o[4]||(o[4]=s=>t.value.chain().focus().toggleCode().run()),disabled:!t.value.can().chain().focus().toggleCode().run(),class:c({"is-active":t.value.isActive("code")})},{default:n(()=>[e(u(d),{icon:["fas","code"]})]),_:1},8,["disabled","class"])]),_:1})]),r("div",pe,[e(l,{title:"段落",content:"一段文字"},{reference:n(()=>[e(a,{onClick:o[5]||(o[5]=s=>t.value.chain().focus().setParagraph().run()),class:c({"is-active":t.value.isActive("paragraph")}),tooltip:"段落"},{default:n(()=>[e(u(d),{icon:["fas","paragraph"]})]),_:1},8,["class"])]),_:1}),e(l,{placement:"top-start",title:"Heading 1",width:100,trigger:"hover",content:"设置为一级标题"},{reference:n(()=>[e(a,{text:"",onClick:o[6]||(o[6]=s=>t.value.chain().focus().toggleHeading({level:2}).run()),class:c({"is-active":t.value.isActive("heading",{level:2})})},{default:n(()=>[f(" h1 ")]),_:1},8,["class"])]),_:1}),e(l,{placement:"top-start",title:"Heading 2",width:100,trigger:"hover",content:"设置为二级标题"},{reference:n(()=>[e(a,{text:"",onClick:o[7]||(o[7]=s=>t.value.chain().focus().toggleHeading({level:1}).run()),class:c({"is-active":t.value.isActive("heading",{level:1})})},{default:n(()=>[f(" h2 ")]),_:1},8,["class"])]),_:1}),e(l,{placement:"top-start",title:"Heading 3",width:100,trigger:"hover",content:"设置为三级标题"},{reference:n(()=>[e(a,{text:"",onClick:o[8]||(o[8]=s=>t.value.chain().focus().toggleHeading({level:3}).run()),class:c({"is-active":t.value.isActive("heading",{level:3})})},{default:n(()=>[f(" h3 ")]),_:1},8,["class"])]),_:1}),e(l,{placement:"top-start",title:"Heading 5",width:100,trigger:"hover",content:"设置为五级标题"},{reference:n(()=>[e(a,{text:"",onClick:o[9]||(o[9]=s=>t.value.chain().focus().toggleHeading({level:5}).run()),class:c({"is-active":t.value.isActive("heading",{level:5})})},{default:n(()=>[f(" h4 ")]),_:1},8,["class"])]),_:1}),e(l,{placement:"top-start",title:"Heading 6",width:100,trigger:"hover",content:"设置为六级标题"},{reference:n(()=>[e(a,{text:"",onClick:o[10]||(o[10]=s=>t.value.chain().focus().toggleHeading({level:6}).run()),class:c({"is-active":t.value.isActive("heading",{level:6})})},{default:n(()=>[f(" h5 ")]),_:1},8,["class"])]),_:1})]),r("div",he,[r("div",we,[e(l,{title:"无序列表",content:"将选中文本转换为无序列表",placement:"top-start"},{reference:n(()=>[e(a,{style:{"margin-bottom":"10px"},onClick:o[11]||(o[11]=s=>t.value.chain().focus().toggleBulletList().run()),class:c({"is-active":t.value.isActive("bulletList")})},{default:n(()=>[e(u(d),{icon:["fas","bars-staggered"]})]),_:1},8,["class"])]),_:1}),e(l,{title:"有序列表",content:"将选中文本转换为有序列表",placement:"top-start"},{reference:n(()=>[e(a,{style:{"margin-bottom":"10px"},onClick:o[12]||(o[12]=s=>t.value.chain().focus().toggleOrderedList().run()),class:c({"is-active":t.value.isActive("orderedList")})},{default:n(()=>[e(u(d),{icon:["fas","list"]})]),_:1},8,["class"])]),_:1}),e(l,{title:"引用块",content:"将选中文本转换为引用块",placement:"top-start"},{reference:n(()=>[e(a,{style:{"margin-bottom":"10px"},onClick:o[13]||(o[13]=s=>t.value.chain().focus().toggleBlockquote().run()),class:c({"is-active":t.value.isActive("blockquote")})},{default:n(()=>[e(u(d),{icon:["fas","quote-left"]})]),_:1},8,["class"])]),_:1}),e(l,{title:"水平线",content:"插入水平分隔线",placement:"top-start"},{reference:n(()=>[e(a,{style:{"margin-bottom":"10px"},onClick:o[14]||(o[14]=s=>t.value.chain().focus().setHorizontalRule().run())},{default:n(()=>[e(u(d),{icon:["fas","ruler-horizontal"]})]),_:1})]),_:1}),e(l,{title:"硬换行",content:"插入硬换行",placement:"top-start"},{reference:n(()=>[e(a,{style:{"margin-bottom":"10px"},onClick:o[15]||(o[15]=s=>t.value.chain().focus().setHardBreak().run())},{default:n(()=>[e(u(d),{icon:["fas","bacon"]})]),_:1})]),_:1})])]),r("div",_e,[e(l,{title:"撤销",placement:"top-start"},{reference:n(()=>[e(a,{onClick:o[16]||(o[16]=s=>t.value.chain().focus().undo().run()),disabled:!t.value.can().chain().focus().undo().run()},{default:n(()=>[e(u(d),{icon:["fas","rotate-left"]})]),_:1},8,["disabled"])]),_:1}),e(l,{title:"重做",placement:"top-start"},{reference:n(()=>[e(a,{onClick:o[17]||(o[17]=s=>t.value.chain().focus().redo().run()),disabled:!t.value.can().chain().focus().redo().run()},{default:n(()=>[e(u(d),{icon:["fas","arrow-rotate-right"]})]),_:1},8,["disabled"])]),_:1})]),r("div",be,[e(l,{title:"清除所有标记",placement:"top-start"},{reference:n(()=>[e(a,{onClick:o[18]||(o[18]=s=>t.value.chain().focus().unsetAllMarks().run())},{default:n(()=>[e(u(d),{icon:["fas","broom"]})]),_:1})]),_:1})])])):y("",!0)]),_:1}),t.value?(g(),p("div",Ce,[e(u(se),{editor:t.value,id:"editor"},null,8,["editor"])])):y("",!0),r("div",ke,[r("div",xe,[r("div",null,w(L.value.name),1)])])]),_:1})]),_:1})]),_:1})]),_:1})])}}};export{He as default};
